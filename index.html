<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Body Filler MasterLab by Dr.K</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 폰트 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050506;
      --bg-elevated: #101014;
      --accent: #F4C7B9;
      --accent-soft: rgba(244, 199, 185, 0.12);
      --accent-border: rgba(244, 199, 185, 0.45);
      --text-main: #F9E6DF;
      --text-sub: #B7A7A0;
      --chip-bg: #15151A;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top left, #24151a 0, #050506 55%);
      color: var(--text-main);
    }

    a { color: inherit; text-decoration: none; }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 20px 10px;
    }

    .brand-area {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .logo-line {
      width: 120px;
      height: 40px;
    }

    .brand-title {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.04em;
    }

    .brand-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .top-actions {
      display: flex;
      gap: 10px;
    }

    .btn-ghost {
      padding: 9px 14px;
      border-radius: 999px;
      border: 1px solid rgba(244,199,185,0.45);
      background: rgba(0,0,0,0.2);
      font-size: 12px;
      color: var(--accent);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-ghost span.icon {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid rgba(244,199,185,0.6);
    }

    main {
      padding: 10px 20px 40px;
      max-width: 960px;
      margin: 0 auto;
    }

    .hero {
      margin-top: 10px;
      padding: 16px 16px 18px;
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(244,199,185,0.12), rgba(5,5,6,0.95));
      border: 1px solid rgba(244,199,185,0.35);
    }

    .hero-title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 8px;
      line-height: 1.35;
    }

    .hero-body {
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.6;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      margin-top: 10px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(244,199,185,0.3);
      color: var(--accent);
    }

    .section-title {
      margin-top: 24px;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
    }

    .section-sub {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 12px;
    }

    .category-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    @media (min-width: 720px) {
      .category-grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    @media (min-width: 1024px) {
      .category-grid {
        grid-template-columns: repeat(5, minmax(0, 1fr));
      }
    }

    .cat-card {
      position: relative;
      padding: 10px 10px 12px;
      border-radius: 16px;
      background: var(--chip-bg);
      border: 1px solid rgba(244,199,185,0.24);
      cursor: pointer;
      overflow: hidden;
      transition: all 0.2s ease-out;
    }

    .cat-card:hover {
      transform: translateY(-2px);
      border-color: rgba(244,199,185,0.8);
      box-shadow: 0 10px 24px rgba(0,0,0,0.6);
    }

    .cat-icon {
      width: 32px;
      height: 32px;
      margin-bottom: 8px;
    }

    .cat-name {
      font-size: 13px;
      font-weight: 500;
    }

    .cat-desc {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 3px;
    }

    footer {
      margin-top: 26px;
      padding-top: 10px;
      border-top: 1px solid rgba(244,199,185,0.14);
      font-size: 11px;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
    }

    .link-like { cursor: pointer; text-decoration: underline; text-underline-offset: 2px; }
  </style>
</head>
<body>

<header>
  <div class="brand-area">
    <!-- 시그니처 라인 로고 -->
    <svg class="logo-line" viewBox="0 0 200 60">
      <path d="M8 46 Q40 8 80 26 T150 20 Q178 10 192 44"
            stroke="#F4C7B9" stroke-width="3" fill="none" stroke-linecap="round"/>
    </svg>
    <div class="brand-title">Body Filler MasterLab by Dr.K</div>
    <div class="brand-sub">바디필러 시술이 아닌 예술을 원한다면. 바디필러 마스터랩에 고민상담부터.</div>
  </div>

  <div class="top-actions">
    <button class="btn-ghost" onclick="goConsult()">
      <span class="icon"></span>
      상담자 모드
    </button>
    <button class="btn-ghost" onclick="goDoctor()">
      <span class="icon"></span>
      닥터 모드
    </button>
  </div>
</header>

<main>
  <section class="hero">
    <div class="hero-title">
      당신의 바디 실루엣을<br/>과학과 예술로 재구성합니다.
    </div>
    <div class="hero-body">
      정수리부터 발끝까지, 필러로 어디까지 가능할까? <br/>
      전신 바디 필러를 수십만 cc 이상 집도해온 닥터K가<br/>
      병원 이름 없이, 오직 바디 실루엣만 보고 방향을 잡아주는 비대면 프리 상담 채널입니다.
    </div>
    <div class="hero-badge">
      <span style="width:6px;height:6px;border-radius:999px;background:#54e38a;"></span>
      온라인 접수 후 순서대로 직접 검토 · 답변
    </div>
  </section>

  <section>
    <div class="section-title">머리부터 발끝까지 · 바디 필러 카테고리</div>
    <div class="section-sub">가장 먼저 바꾸고 싶은 한 부위를 골라주세요. 이후 페이지에서 자세한 고민과 사진을 남기실 수 있어요.</div>

    <div class="category-grid" id="catGrid">
      <!-- 카드들은 JS에서 생성 -->
    </div>
  </section>

  <footer>
    <div>© Body Filler MasterLab by Dr.K</div>
    <div class="link-like" onclick="goDoctor()">닥터 전용 로그인</div>
  </footer>
</main>

<script>
  const CATEGORIES = [
    { key: "정수리", desc: "두상 라인 · 정수리 볼륨" },
    { key: "뒤통수", desc: "뒷통수 볼륨 · 두상" },
    { key: "귀전체", desc: "귀 라인 전체" },
    { key: "귓볼", desc: "귓볼 볼륨 · 비율" },
    { key: "어깨", desc: "어깨선 · 직각 어깨" },
    { key: "근육형 어깨", desc: "삼각근 형상 강조" },
    { key: "이두", desc: "상완 전면 라인" },
    { key: "삼두", desc: "상완 후면 라인" },
    { key: "전완근", desc: "전완근 볼륨 · 실루엣" },
    { key: "팔꿈치 주름", desc: "팔꿈치 주름 완화" },
    { key: "골반(정면)", desc: "정면 골반 폭 · 라인" },
    { key: "힙딥", desc: "옆 엉덩이 파임" },
    { key: "힙전체", desc: "힙 전체 볼륨" },
    { key: "허벅지 필러", desc: "허벅지 전체 볼륨" },
    { key: "허벅지 내외측", desc: "내측·외측 패임" },
    { key: "무릎내측", desc: "무릎 안쪽 패임" },
    { key: "무릎주름", desc: "무릎 주름 완화" },
    { key: "종아리", desc: "종아리 라인" },
    { key: "발목필러", desc: "발목 라인" },
    { key: "발등", desc: "발등 볼륨" },
    { key: "기타", desc: "원하는 바디 어디든" },
  ];

  function createIconSVG() {
    // 공통 얇은 라인 아이콘
    return `
      <svg class="cat-icon" viewBox="0 0 40 40">
        <path d="M6 30 Q14 10 22 16 T34 10"
              stroke="#F4C7B9" stroke-width="1.6" fill="none" stroke-linecap="round"/>
      </svg>
    `;
  }

  const grid = document.getElementById("catGrid");
  CATEGORIES.forEach(cat => {
    const div = document.createElement("div");
    div.className = "cat-card";
    div.innerHTML = `
      ${createIconSVG()}
      <div class="cat-name">${cat.key}</div>
      <div class="cat-desc">${cat.desc}</div>
    `;
    div.addEventListener("click", () => {
      const url = new URL(window.location.origin + "/consult.html");
      url.searchParams.set("part", cat.key);
      window.location.href = url.toString();
    });
    grid.appendChild(div);
  });

  function goConsult() {
    window.location.href = "consult.html";
  }

  function goDoctor() {
    window.location.href = "doctor.html";
  }
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>상담자 모드 - Body Filler MasterLab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050506;
      --bg-elevated: #101014;
      --accent: #F4C7B9;
      --accent-soft: rgba(244, 199, 185, 0.12);
      --accent-border: rgba(244, 199, 185, 0.45);
      --text-main: #F9E6DF;
      --text-sub: #B7A7A0;
      --chip-bg: #14141A;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top left, #24151a 0, #050506 55%);
      color: var(--text-main);
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 16px 18px;
      border-bottom: 1px solid rgba(244,199,185,0.18);
      background: rgba(5,5,6,0.98);
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .back-btn {
      cursor: pointer;
      font-size: 20px;
    }

    .header-title {
      font-size: 15px;
      font-weight: 500;
    }

    main {
      padding: 16px 18px 110px;
      max-width: 820px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-top: 14px;
      margin-bottom: 6px;
    }

    .section-sub {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 10px;
    }

    .cat-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 8px;
      margin-bottom: 4px;
    }

    @media (min-width: 720px) {
      .cat-grid {
        grid-template-columns: repeat(4, minmax(0,1fr));
      }
    }

    .cat-chip {
      padding: 8px 8px 9px;
      border-radius: 12px;
      background: var(--chip-bg);
      border: 1px solid rgba(244,199,185,0.25);
      font-size: 12px;
      text-align: center;
      cursor: pointer;
      transition: all .16s ease-out;
      color: var(--text-sub);
    }

    .cat-chip.selected {
      background: var(--accent);
      color: #111;
      border-color: rgba(255,255,255,0.7);
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
      font-weight: 600;
    }

    textarea {
      width: 100%;
      min-height: 80px;
      padding: 10px 11px;
      border-radius: 10px;
      border: 1px solid rgba(244,199,185,0.28);
      background: rgba(4,4,6,0.92);
      color: var(--text-main);
      font-size: 13px;
      resize: vertical;
      outline: none;
    }

    textarea::placeholder {
      color: rgba(183,167,160,0.7);
    }

    .change-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .change-pill {
      flex: 1 1 30%;
      min-width: 100px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(244,199,185,0.30);
      font-size: 12px;
      text-align: center;
      cursor: pointer;
      color: var(--text-sub);
      background: rgba(10,10,12,0.9);
    }

    .change-pill.selected {
      background: var(--accent);
      color: #111;
      border-color: rgba(255,255,255,0.75);
      font-weight: 600;
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-group input[type="checkbox"] {
      accent-color: var(--accent);
    }

    .file-input {
      width: 100%;
      border-radius: 10px;
      border: 1px dashed rgba(244,199,185,0.35);
      background: rgba(10,10,12,0.85);
      padding: 10px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .file-input input {
      margin-top: 6px;
      width: 100%;
    }

    .submit-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 12px 18px 16px;
      background: linear-gradient(to top, rgba(5,5,6,0.98), rgba(5,5,6,0.75));
      border-top: 1px solid rgba(244,199,185,0.28);
    }

    .submit-btn {
      width: 100%;
      border: none;
      border-radius: 999px;
      background: var(--accent);
      color: #111;
      padding: 14px 0;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }

    .submit-note {
      margin-top: 4px;
      font-size: 10px;
      color: var(--text-sub);
    }

    .status-msg {
      margin-top: 6px;
      font-size: 11px;
      color: var(--accent);
    }

  </style>
</head>
<body>

<header>
  <div class="back-btn" onclick="goBack()">←</div>
  <div class="header-title">상담자 모드 · 바디 필러 상담</div>
</header>

<main>
  <section>
    <div class="section-title">1. 어느 부위가 가장 고민이세요?</div>
    <div class="section-sub">머리부터 발끝까지, 한 부위를 먼저 선택해주세요. 이후 닥터K가 전체 실루엣을 함께 보면서 설명해 줍니다.</div>

    <div class="cat-grid" id="catGrid"></div>
  </section>

  <section>
    <div class="section-title">2. 지금 제일 거슬리는 부분</div>
    <div class="section-sub">거울이나 사진에서 어떤 느낌이 제일 신경 쓰이는지, 편하게 적어주세요.</div>
    <textarea id="concern" placeholder="예) 골반이 좁아서 전체 비율이 답답해 보이고, 힙딥 때문에 레깅스핏이 마음에 안 들어요."></textarea>
  </section>

  <section>
    <div class="section-title">3. 바뀌었으면 하는 느낌·이미지</div>
    <div class="section-sub">원하는 분위기, 셀럽, 워너비 사진 느낌이 있다면 자유롭게 적어주세요.</div>
    <textarea id="desired" placeholder="예) 골반은 살짝 넓어지고, 힙은 자연스럽게 둥근 볼륨. 과한 글래머보단 자연스럽게 비율 좋아 보이는 느낌."></textarea>
  </section>

  <section>
    <div class="section-title">4. 변화 정도</div>
    <div class="section-sub">이번 1차 시술에서 어느 정도까지 변화를 보고 싶은지 선택해주세요.</div>
    <div class="change-row">
      <div class="change-pill" data-key="light">티 거의 안 나게</div>
      <div class="change-pill" data-key="standard">사진에서 딱 보이게</div>
      <div class="change-pill" data-key="full">이미지 체인지급</div>
    </div>
  </section>

  <section>
    <div class="section-title">5. 시술 · 수술 과거력</div>
    <div class="section-sub">해당되는 항목만 체크해 주세요. 정확할수록 상담이 디테일해집니다.</div>
    <div class="checkbox-group">
      <label><input type="checkbox" value="가슴보형물">가슴보형물 삽입</label>
      <label><input type="checkbox" value="힙보형물">힙보형물 삽입</label>
      <label><input type="checkbox" value="지방흡입">지방흡입</label>
      <label><input type="checkbox" value="지방이식">지방이식</label>
      <label><input type="checkbox" value="영구필러">영구필러 주입</label>
      <label><input type="checkbox" value="히알루론산필러">히알루론산 필러 주입</label>
    </div>
    <textarea id="historyExtra" style="margin-top:8px;" placeholder="기타 과거력, 흉터, 교정 중인 부분 등이 있다면 적어주세요. (선택사항)"></textarea>
  </section>

  <section>
    <div class="section-title">6. 현재 바디 사진 업로드</div>
    <div class="section-sub">정면 / 45도 / 옆 / 후면 등을 3~6장 정도 첨부해주시면 좋아요. 얼굴은 잘려 있어도 괜찮습니다.</div>
    <div class="file-input">
      <div>정면/측면/후면 사진 · 영상 (최대 10개)</div>
      <input id="bodyFiles" type="file" accept="image/*,video/*" multiple />
    </div>
  </section>

  <section>
    <div class="section-title">7. 참고 워너비 사진 (선택)</div>
    <div class="section-sub">인스타·핀터레스트 전후사진, 셀럽 바디라인 등 참고했으면 하는 이미지를 업로드해주세요.</div>
    <div class="file-input">
      <div>워너비/레퍼런스 사진</div>
      <input id="refFiles" type="file" accept="image/*" multiple />
    </div>
  </section>

  <div class="status-msg" id="status"></div>
</main>

<div class="submit-bar">
  <button class="submit-btn" id="submitBtn">닥터K에게 상담 보내기</button>
  <div class="submit-note">※ 실시간 채팅이 아니며, 접수 순서대로 닥터K가 직접 답변드립니다.</div>
</div>

<script>
  const SUPABASE_URL = "https://mljhxswtlahjqexlxlwh.supabase.co";
  const SUPABASE_KEY = "sb_publishable_zhjzgeDAxcImr4july-7Pw_2h2DQAc3";
  const STORAGE_BUCKET = "drk-photos";

  const { createClient } = supabase;
  const client = createClient(SUPABASE_URL, SUPABASE_KEY);

  const CATEGORIES = [
    "정수리","뒤통수","귀전체","귓볼",
    "어깨","근육형 어깨",
    "이두","삼두","전완근","팔꿈치 주름",
    "골반(정면)","힙딥","힙전체",
    "허벅지 필러","허벅지 내외측",
    "무릎내측","무릎주름",
    "종아리","발목필러","발등",
    "기타"
  ];

  const catGrid = document.getElementById("catGrid");
  let selectedPart = "";

  function buildCategories() {
    CATEGORIES.forEach(name => {
      const div = document.createElement("div");
      div.className = "cat-chip";
      div.innerText = name;
      div.addEventListener("click", () => {
        selectedPart = name;
        document.querySelectorAll(".cat-chip").forEach(c => c.classList.remove("selected"));
        div.classList.add("selected");
      });
      catGrid.appendChild(div);
    });

    const urlParams = new URLSearchParams(window.location.search);
    const preset = urlParams.get("part");
    if (preset && CATEGORIES.includes(preset)) {
      const chip = Array.from(document.querySelectorAll(".cat-chip")).find(c => c.innerText === preset);
      if (chip) {
        chip.classList.add("selected");
        selectedPart = preset;
      }
    }
  }

  buildCategories();

  let changeLevel = "";
  document.querySelectorAll(".change-pill").forEach(pill => {
    pill.addEventListener("click", () => {
      changeLevel = pill.dataset.key;
      document.querySelectorAll(".change-pill").forEach(p => p.classList.remove("selected"));
      pill.classList.add("selected");
    });
  });

  function goBack() {
    if (document.referrer) {
      history.back();
    } else {
      window.location.href = "index.html";
    }
  }

  async function uploadFiles(caseId, type, fileList) {
    const urls = [];
    for (let i = 0; i < fileList.length; i++) {
      const f = fileList[i];
      const path = `${caseId}/${type}-${Date.now()}-${i}-${f.name}`;
      const { data, error } = await client.storage
        .from(STORAGE_BUCKET)
        .upload(path, f);

      if (error) {
        console.error("upload error", error);
        continue;
      }

      const { data: pub } = client.storage.from(STORAGE_BUCKET).getPublicUrl(path);
      const publicUrl = pub.publicUrl;

      await client.from("photos").insert({
        case_id: caseId,
        type: type,
        url: publicUrl
      });

      urls.push(publicUrl);
    }
    return urls;
  }

  const statusEl = document.getElementById("status");
  const submitBtn = document.getElementById("submitBtn");

  submitBtn.addEventListener("click", async () => {
    try {
      statusEl.textContent = "";

      if (!selectedPart) {
        alert("어디가 가장 고민인지 한 부위를 선택해주세요.");
        return;
      }

      const concern = document.getElementById("concern").value.trim();
      if (!concern) {
        alert("지금 제일 고민되는 부분을 한 줄 이상 적어주세요.");
        return;
      }

      const desired = document.getElementById("desired").value.trim();
      const historyChecked = Array.from(document.querySelectorAll(".checkbox-group input:checked"))
        .map(c => c.value);
      const historyExtra = document.getElementById("historyExtra").value.trim();
      const history = [...historyChecked, historyExtra].filter(Boolean).join(" / ");

      statusEl.textContent = "상담을 저장하는 중입니다. 잠시만 기다려주세요...";

      const { data: caseData, error: caseErr } = await client
        .from("cases")
        .insert({
          part: selectedPart,
          partGroup: "Body",
          concern,
          desired,
          changeLevel: changeLevel || null,
          history,
          status: "new"
        })
        .select("*")
        .single();

      if (caseErr) {
        console.error(caseErr);
        alert("상담 저장 중 문제가 발생했습니다. 잠시 후 다시 시도해주세요.");
        statusEl.textContent = "";
        return;
      }

      const caseId = caseData.id;

      const bodyFiles = document.getElementById("bodyFiles").files;
      const refFiles = document.getElementById("refFiles").files;

      if (bodyFiles.length > 0) {
        await uploadFiles(caseId, "body", bodyFiles);
      }
      if (refFiles.length > 0) {
        await uploadFiles(caseId, "ref", refFiles);
      }

      const firstMessageText =
        `부위: ${selectedPart}\n` +
        (concern ? `고민: ${concern}\n` : "") +
        (desired ? `원하는 이미지: ${desired}\n` : "") +
        (changeLevel ? `변화 정도: ${changeLevel}\n` : "") +
        (history ? `시술/수술 과거력: ${history}` : "");

      await client.from("messages").insert({
        case_id: caseId,
        from: "user",
        text: firstMessageText
      });

      statusEl.textContent = "상담 접수가 완료되었습니다.";
      window.location.href = "success.html";
    } catch (e) {
      console.error(e);
      alert("알 수 없는 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
      statusEl.textContent = "";
    }
  });
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>상담 접수 완료 - Body Filler MasterLab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top left, #24151a 0, #050506 55%);
      color: #F9E6DF;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .box {
      text-align: center;
      padding: 26px 24px;
      border-radius: 18px;
      background: rgba(10,10,12,0.94);
      border: 1px solid rgba(244,199,185,0.4);
      max-width: 360px;
      width: 90%;
    }

    h1 {
      font-size: 20px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    p {
      font-size: 13px;
      color: #B7A7A0;
      margin-bottom: 18px;
      line-height: 1.5;
    }

    .pin {
      font-size: 11px;
      color: #8e7d76;
      margin-bottom: 18px;
    }

    button {
      width: 100%;
      padding: 13px 0;
      border-radius: 999px;
      border: none;
      background: #F4C7B9;
      color: #111;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 8px;
    }

    .sub-link {
      font-size: 11px;
      color: #B7A7A0;
      text-decoration: underline;
      text-underline-offset: 2px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="box">
  <h1>상담 접수 완료되었습니다.</h1>
  <p>닥터K가 순서대로 케이스를 검토한 뒤,<br/>가능한 범위 · 볼륨 방향 · 주의해야 할 점들을 정리해서 답변 드립니다.</p>
  <div class="pin">※ 닥터 전용 PIN : <b>112955</b> (외부 공유 금지)</div>
  <button onclick="location.href='index.html'">홈으로 돌아가기</button>
  <div class="sub-link" onclick="location.href='doctor.html'">닥터 모드로 바로 이동</div>
</div>

</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>닥터 모드 - Body Filler MasterLab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050506;
      --bg-elevated: #101014;
      --accent: #F4C7B9;
      --accent-soft: rgba(244, 199, 185, 0.12);
      --accent-border: rgba(244, 199, 185, 0.45);
      --text-main: #F9E6DF;
      --text-sub: #B7A7A0;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: radial-gradient(circle at top left, #24151a 0, #050506 55%);
      color: var(--text-main);
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      border-bottom: 1px solid rgba(244,199,185,0.18);
      background: rgba(5,5,6,0.98);
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .left-header {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .back-btn {
      cursor: pointer;
      font-size: 20px;
    }

    .logo-mini {
      width: 60px;
      height: 24px;
    }

    .header-title {
      font-size: 14px;
      font-weight: 500;
    }

    main {
      padding: 16px 16px 40px;
      max-width: 960px;
      margin: 0 auto;
    }

    .card {
      background: rgba(6,6,10,0.96);
      border-radius: 16px;
      border: 1px solid rgba(244,199,185,0.35);
      padding: 16px;
      margin-bottom: 14px;
    }

    .login-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(244,199,185,0.4);
      background: rgba(8,8,12,0.95);
      color: var(--text-main);
      outline: none;
      font-size: 14px;
      letter-spacing: 0.3em;
      text-align: center;
    }

    .btn-main {
      width: 100%;
      margin-top: 12px;
      padding: 11px 0;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #111;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .small {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 8px;
    }

    .case-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .case-item {
      border-radius: 12px;
      border: 1px solid rgba(244,199,185,0.25);
      background: rgba(10,10,14,0.95);
      padding: 10px 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .case-item.new {
      border-color: #F97373;
    }

    .case-item.answered {
      border-color: rgba(244,199,185,0.45);
    }

    .case-head {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
    }

    .case-part {
      font-weight: 600;
    }

    .case-status {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(249,115,115,0.15);
      color: #ff9292;
    }

    .case-status.answered {
      background: rgba(114,227,173,0.12);
      color: #7be3b4;
    }

    .case-preview {
      font-size: 11px;
      color: var(--text-sub);
    }

    .case-date {
      font-size: 10px;
      color: #7e726c;
    }

    .hidden { display: none; }

    .detail-grid {
      display: grid;
      grid-template-columns: repeat(1, minmax(0,1fr));
      gap: 10px;
    }

    @media (min-width: 720px) {
      .detail-grid {
        grid-template-columns: 2fr 3fr;
      }
    }

    .detail-label {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 3px;
    }

    .detail-box {
      background: rgba(6,6,10,0.95);
      border-radius: 10px;
      border: 1px solid rgba(244,199,185,0.35);
      padding: 10px;
      font-size: 12px;
      color: var(--text-main);
    }

    .photo-wrap {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .photo-wrap img,
    .photo-wrap video {
      max-width: 140px;
      border-radius: 8px;
      border: 1px solid rgba(244,199,185,0.35);
    }

    .message-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .msg {
      padding: 8px 9px;
      border-radius: 10px;
      font-size: 11px;
      line-height: 1.4;
      max-width: 100%;
      white-space: pre-wrap;
    }

    .msg.user {
      background: rgba(17,24,39,0.95);
      align-self: flex-start;
      border: 1px solid rgba(148,163,184,0.8);
    }

    .msg.doctor {
      background: rgba(244,199,185,0.98);
      color: #111;
      align-self: flex-end;
    }

    .reply-box textarea {
      width: 100%;
      min-height: 80px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(244,199,185,0.4);
      background: rgba(7,7,10,0.95);
      color: var(--text-main);
      font-size: 12px;
      resize: vertical;
      outline: none;
    }

    .reply-btn {
      margin-top: 8px;
      width: 100%;
      padding: 9px 0;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #111;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(244,199,185,0.5);
      color: var(--text-sub);
      margin-top: 4px;
    }

  </style>
</head>
<body>

<header>
  <div class="left-header">
    <div class="back-btn" onclick="goHome()">←</div>
    <svg class="logo-mini" viewBox="0 0 200 40">
      <path d="M8 30 Q40 5 80 16 T150 14 Q178 8 192 28"
            stroke="#F4C7B9" stroke-width="3" fill="none" stroke-linecap="round"/>
    </svg>
    <div class="header-title">닥터 모드 · Body Filler MasterLab</div>
  </div>
</header>

<main>
  <!-- 로그인 카드 -->
  <section id="loginSection" class="card">
    <div style="font-size:13px;font-weight:600;margin-bottom:8px;">PIN 입력</div>
    <div style="font-size:11px;color:var(--text-sub);margin-bottom:10px;">
      닥터K 전용 뷰입니다. PIN 6자리를 입력하면 오늘 접수된 케이스들을 차트처럼 볼 수 있습니다.
    </div>
    <input id="pinInput" maxlength="6" class="login-input" placeholder="••••••" />
    <button class="btn-main" onclick="login()">닥터 모드 들어가기</button>
    <div class="small">※ PIN은 브라우저에 저장되지 않습니다.</div>
  </section>

  <!-- 대시보드 -->
  <section id="dashboardSection" class="hidden">
    <div class="card">
      <div style="font-size:13px;font-weight:600;margin-bottom:6px;">접수된 케이스</div>
      <div id="caseCount" class="small"></div>
      <div class="case-list" id="caseList"></div>
    </div>

    <div id="detailCard" class="card hidden">
      <div style="font-size:13px;font-weight:600;margin-bottom:8px;">
        선택된 케이스 상세
      </div>
      <div id="detailContent"></div>
    </div>
  </section>
</main>

<script>
  const SUPABASE_URL = "https://mljhxswtlahjqexlxlwh.supabase.co";
  const SUPABASE_KEY = "sb_publishable_zhjzgeDAxcImr4july-7Pw_2h2DQAc3";
  const { createClient } = supabase;
  const client = createClient(SUPABASE_URL, SUPABASE_KEY);

  const DOCTOR_PIN = "112955";

  function goHome() {
    window.location.href = "index.html";
  }

  function login() {
    const input = document.getElementById("pinInput").value.trim();
    if (input === DOCTOR_PIN) {
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("dashboardSection").classList.remove("hidden");
      loadCases();
    } else {
      alert("PIN이 올바르지 않습니다.");
    }
  }

  async function loadCases() {
    const { data, error } = await client
      .from("cases")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      console.error(error);
      alert("케이스 목록을 불러오는 중 오류가 발생했습니다.");
      return;
    }

    const caseListEl = document.getElementById("caseList");
    caseListEl.innerHTML = "";

    document.getElementById("caseCount").textContent =
      data.length ? `${data.length}건 접수됨` : "아직 접수된 케이스가 없습니다.";

    data.forEach(c => {
      const div = document.createElement("div");
      div.className = "case-item " + (c.status === "answered" ? "answered" : "new");
      div.addEventListener("click", () => openCase(c.id));

      const created = c.created_at ? new Date(c.created_at) : null;
      const dateStr = created
        ? created.toLocaleString("ko-KR", { month:"short", day:"numeric", hour:"2-digit", minute:"2-digit" })
        : "";

      div.innerHTML = `
        <div class="case-head">
          <div class="case-part">${c.part || "부위 미입력"}</div>
          <div class="case-status ${c.status === "answered" ? "answered" : ""}">
            ${c.status === "answered" ? "답변 완료" : "새 상담"}
          </div>
        </div>
        <div class="case-preview">${(c.concern || "").slice(0,60) || "—"}</div>
        <div class="case-date">${dateStr}</div>
      `;

      caseListEl.appendChild(div);
    });
  }

  async function openCase(caseId) {
    const { data: c, error } = await client
      .from("cases")
      .select("*")
      .eq("id", caseId)
      .single();

    if (error) {
      console.error(error);
      alert("케이스 정보를 불러오는 중 오류가 발생했습니다.");
      return;
    }

    const { data: photos } = await client
      .from("photos")
      .select("*")
      .eq("case_id", caseId);

    const { data: messages } = await client
      .from("messages")
      .select("*")
      .eq("case_id", caseId)
      .order("created_at", { ascending: true });

    const detail = document.getElementById("detailContent");
    const detailCard = document.getElementById("detailCard");
    detailCard.classList.remove("hidden");

    const created = c.created_at ? new Date(c.created_at) : null;
    const dateStr = created
      ? created.toLocaleString("ko-KR", { year:"numeric", month:"short", day:"numeric", hour:"2-digit", minute:"2-digit" })
      : "";

    const photosHtml = (photos || []).map(p => {
      const url = p.url;
      const lower = url.toLowerCase();
      if (lower.endsWith(".mp4") || lower.endsWith(".mov") || lower.endsWith(".webm")) {
        return `<video src="${url}" controls></video>`;
      }
      return `<img src="${url}" alt="photo" />`;
    }).join("");

    const messagesHtml = (messages || []).map(m => `
      <div class="msg ${m.from === "doctor" ? "doctor" : "user"}">
        ${m.text || ""}
      </div>
    `).join("");

    detail.innerHTML = `
      <div class="detail-grid">
        <div>
          <div class="detail-label">부위</div>
          <div class="detail-box">
            ${c.part || "—"}
            <div class="pill">${c.changeLevel || "변화 레벨 미입력"}</div>
          </div>

          <div class="detail-label" style="margin-top:8px;">고민</div>
          <div class="detail-box">${c.concern || "—"}</div>

          <div class="detail-label" style="margin-top:8px;">원하는 이미지</div>
          <div class="detail-box">${c.desired || "—"}</div>

          <div class="detail-label" style="margin-top:8px;">시술 · 수술 과거력</div>
          <div class="detail-box">${c.history || "—"}</div>

          <div class="detail-label" style="margin-top:8px;">접수 일시</div>
          <div class="detail-box">${dateStr || "—"}</div>
        </div>

        <div>
          <div class="detail-label">사진 / 영상</div>
          <div class="detail-box">
            <div class="photo-wrap">
              ${photosHtml || "<span style='font-size:11px;color:var(--text-sub);'>첨부된 파일이 없습니다.</span>"}
            </div>
          </div>

          <div class="detail-label" style="margin-top:8px;">대화 내역</div>
          <div class="detail-box" style="padding:8px 10px;">
            <div class="message-list">
              ${messagesHtml || "<span style='font-size:11px;color:var(--text-sub);'>아직 메시지가 없습니다.</span>"}
            </div>
          </div>

          <div class="detail-label" style="margin-top:8px;">닥터 답변 작성</div>
          <div class="detail-box reply-box">
            <textarea id="replyInput" placeholder="필러로 가능한 범위, 예상 볼륨 존, 주의점, 단계별 전략 등을 적어주세요."></textarea>
            <button class="reply-btn" onclick="sendReply('${caseId}')">답변 보내기 & 상태 완료 처리</button>
          </div>
        </div>
      </div>
    `;
  }

  async function sendReply(caseId) {
    const text = document.getElementById("replyInput").value.trim();
    if (!text) {
      alert("답변 내용을 입력해주세요.");
      return;
    }

    const { error: msgErr } = await client.from("messages").insert({
      case_id: caseId,
      from: "doctor",
      text
    });

    if (msgErr) {
      console.error(msgErr);
      alert("메시지 저장 중 오류가 발생했습니다.");
      return;
    }

    const { error: updErr } = await client
      .from("cases")
      .update({ status: "answered" })
      .eq("id", caseId);

    if (updErr) {
      console.error(updErr);
      alert("케이스 상태 업데이트 중 오류가 발생했습니다.");
      return;
    }

    alert("답변이 저장되었습니다.");
    loadCases();
    openCase(caseId);
  }
</script>
</body>
</html>
